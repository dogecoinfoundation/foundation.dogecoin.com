
+++
title = "Advisory: トランザクションが自動的に再試行される問題の対応について"
date = "2021-11-11"
[ author ]
  name = "Dogecoin Foundation"
+++

注：この勧告の以前のバージョンでは、財団とは別の団体を指すために「私たち」が使用されていました。を明確にするために編集されました。。

Binanceは本日、Dogecoinの出金を一時停止し、Dogecoinに「小さな問題」を発見したと述べました。当財団はこの問題について対処したいと思っております。

数ヶ月前（以前の投稿では1年と書かれていましたが、最初に確認された言及は4月です）、BinanceはDogecoin Coreのメンテナのグループに、Binanceにはトランザクションがスタックするケースがある、つまりトランザクションがうまく採掘されていないことを通知しました。メンテナンス担当者は、バイナンスがこれらの取引にRBF（replace by fee）を使用することを提案し、これは元の取引をより高い手数料が支払われた新しい取引に置き換えるものでした。注目すべきは、手数料による置き換えは前の取引を無効にするため、これが提案されたことです（それゆえ「置き換える」のです）。この取引ではRBFが無効になっているため、Binanceは新しい取引を手動で作成し、同じ入力を消費して前の取引を強制的に無効にすることが推奨されました。

しばらくして、Binanceはアカウント照合の問題があることをメンテナに通知しました。メンテナンス担当者は、Binanceから与えられたデータでこれらの問題を再現することができませんでしたが、当時、問題を軽減するために `-zapwallettxes` コマンドラインオプションを使用することを提案しました。これは、このオプションが今回の問題を防いだだろうと予想されるため、注目されています。

昨日11月10日、Binanceより、1.14.5アップデート後、以前は中継できなかったトランザクションが突然中継できるようになったとの連絡がありました。おそらく1.14.5で最低手数料が下げられ、以前は有効だが中継できなかったトランザクションが中継できるようになったためと思われます。提供された唯一の例は、v1.14.5時点では有効でしたが、1.14.3以前では無効（低すぎた）だった手数料を持つトランザクションでした。なお、Binanceはここ数日でv1.14.3から1.14.5へ直接アップデートを実施しています。

現状で明らかとなっている情報では、アップグレード後の各ノードの再起動時に起こるように、以前は止まっていたトランザクションが自動的に再試行され、必要な最低中継料が低くなったため、トランザクションが通過したことが想定されています。これは、料金の引き下げに伴う正しい動作でした。

## 本件に関する教訓

* トランザクションをキャンセルする正しい処理は、キャンセルされる予定のトランザクションの入力を別のトランザクションに費やすことであり、それは最初のトランザクションを無効にしましょう。
  * 理想的にはreplace-by-feeがあればそれを使用するが、そうでない場合、以前に選択した入力を使用するトランザクションを作成し送信すると、以前のトランザクションを無効にしてしまいます。
* トランザクションには定義されたタイムアウト時間がないが、通常、メモリ制限のために破棄されることに注意が必要です。

## 本件に関する案内

The Foundation has received no further reports of this happening. For any providers with concerns about stagnant invalid transactions, we recommend stopping the nodes, removing the mempool.dat file just in case, and then starting the node with `-zapwallettxes`.

個人ユーザーの方で、心配な方は、Dogecoinをすべて自分自身に送り返すことをでこの問題を解決することが可能です。（理想は新規アドレスへの送付ですが、既存のアドレスを使うこともできます。）取引出力を行うため、そのような自己取引もトランザクショが消費され、取引自体は無効として承認されないことご留意下さい。

